<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <style>
    body {
      margin: 0;
      background-color: #131313;
    }

    body.loaded {
      height: 1000vh;
    }

    #sticky {
      position: sticky;
      top: 0;
      height: 100vh;
    }

    canvas {
      position: relative;
    }

    p.left,
    p.right {
      font-size: 28px;
      color: #fff;
      font-family: Helvetica;
      font-weight: bold;
      position: absolute;
      top: 45%;
      opacity: 0;
    }

    p.left {
      left: 50%;
    }

    p.right {
      right: 50%;
    }

    #loading {
			width: 100%;
			height: 100%;
      font-size: 80px;
      font-family: Helvetica;
      color: #fff;
      position: absolute;
			top: 0;
      text-align: center;
      z-index: 10;
      font-weight: bold;
      background: url("https://cdn.autonomous.ai/landing-page/the_essential_standing_desk/SD2_Pro_000.jpg") no-repeat center center;
      background-size: 100% 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      /* margin-top: -50px; */
      transition: 0.5s opacity ease-in-out;
      transition-delay: 2s;
    }

    body.loaded #loading {
      display: none;
    }
  </style>
  <body>
    <div id="sticky">
      <canvas id="iphone-se"></canvas>

      <div id="loading">
        <p>text-content</p>
      </div>
			
			<!-- 
      <p class="left">Durable glass and<br />aluminum design</p>

      <p class="right">Brilliant 4.7‚Äù<br />Retina HD<br />display</p> -->
    </div>
  </body>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="tool/PxLoader.js"></script>
  <script type="text/javascript" src="tool/PxLoaderImage.js"></script>

  <script>
		$(window).on("scroll", function () {
			let scrolled = document.documentElement.scrollTop / (document.documentElement.scrollHeight - document.documentElement.clientHeight);

			let frame = Math.ceil(scrolled * 282);

			changeFrame(frame);

			// showHideText($(".left"), scrolled, 0.45, 0.52, 0.58, 0.65);
			// showHideText($(".right"), scrolled, 0.9, 1);
		});

		const loader = new PxLoader();

		const images = [];

		for (let i = 0; i < 283; i++) {
			let num = `${i}`.padStart(3, "0");
			images[i] = loader.addImage(`https://cdn.autonomous.ai/landing-page/the_essential_standing_desk/SD2_Pro_${num}.jpg`);
		}

		loader.addCompletionListener(function () {
			let context = $("#iphone-se")[0].getContext("2d");

			$("body").addClass("loaded");

			context.drawImage(images[0], 0, 0, window.innerWidth, window.innerHeight);
		});

		loader.start();
		
    function changeFrame(frame) {
      let index = frame - 1;
      if (index < 0) index = 0;
      if (index > 282) index = 282;

      let context = $("#iphone-se")[0].getContext("2d");

      context.drawImage(images[index], 0, 0, window.innerWidth, window.innerHeight);
    }

    function showHideText(el, current, showFrom, showTo, hideFrom, hideTo) {
      if (current < showFrom) {
        $(el).css("opacity", 0);
      }

      if (current >= showFrom && current <= showTo) {
        $(el).css("opacity", (current - showFrom) / (showTo - showFrom));
      }

      if (typeof hideFrom !== "undefined" && typeof hideTo !== "undefined") {
        if (current > hideFrom && current <= hideTo) {
          $(el).css("opacity", (hideTo - current) / (hideTo - hideFrom));
        }

        if (current > hideTo) {
          $(el).css("opacity", 0);
        }
      }
    }

		window.addEventListener("resize", resizeCanvas, false);
		
		function resizeCanvas() {
			const cav = document.querySelector('#iphone-se');

			cav.style.width = window.innerWidth - 18 + 'px';	
			cav.style.height =  window.innerHeight + 'px';

			cav.width = window.innerWidth;	
			cav.height = window.innerHeight;
		}

		resizeCanvas();
  </script>
</html>
